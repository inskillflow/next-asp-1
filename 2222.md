ok, on respire 😅 — voilà **Phase 1** en **même style**, **ultra-exhaustive**, avec **UNE GROSSE TABLE récap des endpoints tout en haut** (avant les sections), **ancres HTML stables**, et **100% compatible avec ta Phase 3** (mêmes URLs/payloads; tu ajouteras 401/403 plus tard).

---

# Phase 1 — Développement des APIs (Next.js + Prisma/PostgreSQL)

<ul>
  <li><a href="#sec-phase1">Phase 1 — Développement des APIs</a></li>
  <li><a href="#sec-master">1 – Tableau récapitulatif EXHAUSTIF des endpoints</a></li>
  <li><a href="#sec-conventions">2 – Conventions HTTP (communes)</a></li>
  <li>
    <a href="#sec-endpoints">3 – Endpoints (détails, I/O & liens)</a>
    <ul>
      <li><a href="#sec-courses">3.1 Courses — /api/courses</a> (<a href="#ep-courses-list">liste</a>, <a href="#ep-courses-create">create</a>, <a href="#ep-courses-get">get</a>, <a href="#ep-courses-update">update</a>, <a href="#ep-courses-delete">delete</a>)</li>
      <li><a href="#sec-instructors">3.2 Instructors — /api/instructors</a> (<a href="#ep-instructors-list">liste</a>, <a href="#ep-instructors-create">create</a>, <a href="#ep-instructors-get">get</a>, <a href="#ep-instructors-update">update</a>, <a href="#ep-instructors-delete">delete</a>)</li>
      <li><a href="#sec-students">3.3 Students — /api/students</a> (<a href="#ep-students-list">liste</a>, <a href="#ep-students-create">create</a>, <a href="#ep-students-get">get</a>, <a href="#ep-students-update">update</a>, <a href="#ep-students-delete">delete</a>)</li>
      <li><a href="#sec-enrollments">3.4 Enrollments — /api/enrollments</a> (<a href="#ep-enrollments-list">liste</a>, <a href="#ep-enrollments-create">create</a>, <a href="#ep-enrollments-get">get</a>, <a href="#ep-enrollments-update">update</a>, <a href="#ep-enrollments-delete">delete</a>)</li>
      <li><a href="#sec-health">3.5 Health — /api/health</a></li>
    </ul>
  </li>
  <li><a href="#sec-schemas">4 – Schémas de données (types de réponse)</a></li>
  <li><a href="#sec-validation">5 – Règles de validation (résumé)</a></li>
  <li><a href="#sec-errors">6 – Erreurs & format commun</a></li>
  <li><a href="#sec-openapi">7 – OpenAPI (extrait prêt à coller)</a></li>
  <li><a href="#sec-compat">8 – Compatibilité Phase 3 (ajout auth/rôles sans casser)</a></li>
</ul>

<h1 id="sec-phase1">Phase 1 — Développement des APIs</h1>

<h2 id="sec-master">1 – Tableau récapitulatif EXHAUSTIF des endpoints</h2>

> **Phase 1 :** tous publics (pas d’auth). **Phase 3 :** mêmes endpoints, on ajoute 401/403 via guards.

| #  | Ressource   | Méthode | URL                     | Query (liste)                                         | Body (req)                                                          | Réponse succès              | Codes succès | Erreurs typiques | Ancre                                                       |
| -- | ----------- | ------- | ----------------------- | ----------------------------------------------------- | ------------------------------------------------------------------- | --------------------------- | ------------ | ---------------- | ----------------------------------------------------------- |
| 1  | Courses     | GET     | `/api/courses`          | `page,size,sort,level,instructorId,priceMin,priceMax` | —                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-courses-list">#ep-courses-list</a>             |
| 2  | Courses     | POST    | `/api/courses`          | —                                                     | `{title,description,instructorId,duration,maxStudents,price,level}` | `Course`                    | 201          | 422,409,500      | <a href="#ep-courses-create">#ep-courses-create</a>         |
| 3  | Courses     | GET     | `/api/courses/{id}`     | —                                                     | —                                                                   | `Course`                    | 200/404      | 404,500          | <a href="#ep-courses-get">#ep-courses-get</a>               |
| 4  | Courses     | PUT     | `/api/courses/{id}`     | —                                                     | (mêmes champs, partiels ok)                                         | `Course`                    | 200/404      | 422,404,409,500  | <a href="#ep-courses-update">#ep-courses-update</a>         |
| 5  | Courses     | DELETE  | `/api/courses/{id}`     | —                                                     | —                                                                   | —                           | 204/404      | 404,500          | <a href="#ep-courses-delete">#ep-courses-delete</a>         |
| 6  | Instructors | GET     | `/api/instructors`      | `page,size,sort,email,specialty`                      | —                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-instructors-list">#ep-instructors-list</a>     |
| 7  | Instructors | POST    | `/api/instructors`      | —                                                     | `{firstName,lastName,specialty,email,hireDate}`                     | `Instructor`                | 201          | 422,409,500      | <a href="#ep-instructors-create">#ep-instructors-create</a> |
| 8  | Instructors | GET     | `/api/instructors/{id}` | —                                                     | —                                                                   | `Instructor`                | 200/404      | 404,500          | <a href="#ep-instructors-get">#ep-instructors-get</a>       |
| 9  | Instructors | PUT     | `/api/instructors/{id}` | —                                                     | (champs du POST)                                                    | `Instructor`                | 200/404      | 422,404,409,500  | <a href="#ep-instructors-update">#ep-instructors-update</a> |
| 10 | Instructors | DELETE  | `/api/instructors/{id}` | —                                                     | —                                                                   | —                           | 204/404      | 404,500          | <a href="#ep-instructors-delete">#ep-instructors-delete</a> |
| 11 | Students    | GET     | `/api/students`         | `page,size,sort,email,level`                          | —                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-students-list">#ep-students-list</a>           |
| 12 | Students    | POST    | `/api/students`         | —                                                     | `{firstName,lastName,email,registrationDate,level}`                 | `Student`                   | 201          | 422,409,500      | <a href="#ep-students-create">#ep-students-create</a>       |
| 13 | Students    | GET     | `/api/students/{id}`    | —                                                     | —                                                                   | `Student`                   | 200/404      | 404,500          | <a href="#ep-students-get">#ep-students-get</a>             |
| 14 | Students    | PUT     | `/api/students/{id}`    | —                                                     | (champs du POST)                                                    | `Student`                   | 200/404      | 422,404,409,500  | <a href="#ep-students-update">#ep-students-update</a>       |
| 15 | Students    | DELETE  | `/api/students/{id}`    | —                                                     | —                                                                   | —                           | 204/404      | 404,500          | <a href="#ep-students-delete">#ep-students-delete</a>       |
| 16 | Enrollments | GET     | `/api/enrollments`      | `page,size,sort,status,courseId,studentId`            | —                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-enrollments-list">#ep-enrollments-list</a>     |
| 17 | Enrollments | POST    | `/api/enrollments`      | —                                                     | `{courseId,studentId,status,grade?}`                                | `Enrollment`                | 201          | 422,409,500      | <a href="#ep-enrollments-create">#ep-enrollments-create</a> |
| 18 | Enrollments | GET     | `/api/enrollments/{id}` | —                                                     | —                                                                   | `Enrollment`                | 200/404      | 404,500          | <a href="#ep-enrollments-get">#ep-enrollments-get</a>       |
| 19 | Enrollments | PUT     | `/api/enrollments/{id}` | —                                                     | `{status?,grade?}`                                                  | `Enrollment`                | 200/404      | 422,404,500      | <a href="#ep-enrollments-update">#ep-enrollments-update</a> |
| 20 | Enrollments | DELETE  | `/api/enrollments/{id}` | —                                                     | —                                                                   | —                           | 204/404      | 404,500          | <a href="#ep-enrollments-delete">#ep-enrollments-delete</a> |
| 21 | Health      | GET     | `/api/health`           | —                                                     | —                                                                   | `{status,db,time}`          | 200/500      | 500              | <a href="#ep-health">#ep-health</a>                         |

<h2 id="sec-conventions">2 – Conventions HTTP (communes)</h2>
JSON, pagination `page/size`, tri `sort=field:asc|desc`, dates ISO-UTC, 2xx constants; **401/403 seront ajoutés en Phase 3 sans changer cette table**.

<h2 id="sec-endpoints">3 – Endpoints (détails, I/O & liens)</h2>

<h3 id="sec-courses">3.1 Courses — /api/courses</h3>

<h4 id="ep-courses-list">GET /api/courses</h4>
Query: `page,size,sort,level,instructorId,priceMin,priceMax`  
200:
```json
{ "items":[{"id":"uuid","title":"...","level":"Beginner","price":299.99,"instructorId":"uuid","createdAt":"..."}], "page":1,"size":20,"total":42 }
```

<h4 id="ep-courses-create">POST /api/courses</h4>
Body:
```json
{ "title":"Intro C#","description":"...","instructorId":"uuid","duration":40,"maxStudents":30,"price":299.99,"level":"Beginner" }
```
201: `Course`  ·  422/409/500

<h4 id="ep-courses-get">GET /api/courses/{id}</h4> 200/404

<h4 id="ep-courses-update">PUT /api/courses/{id}</h4> Body = champs du POST (partiels ok) · 200/404 · 422/409/500

<h4 id="ep-courses-delete">DELETE /api/courses/{id}</h4> 204/404

---

<h3 id="sec-instructors">3.2 Instructors — /api/instructors</h3>

<h4 id="ep-instructors-list">GET /api/instructors</h4>
Query: `page,size,sort,email,specialty`  
200:
```json
{ "items":[{"id":"uuid","firstName":"Ada","lastName":"Lovelace","email":"ada@ex.com","specialty":"Informatique","hireDate":"2019-08-20","createdAt":"..."}], "page":1,"size":20,"total":3 }
```

<h4 id="ep-instructors-create">POST /api/instructors</h4>
Body:
```json
{ "firstName":"Ada","lastName":"Lovelace","specialty":"Informatique","email":"ada@ex.com","hireDate":"2019-08-20" }
```
201: `Instructor` · 422/409/500

<h4 id="ep-instructors-get">GET /api/instructors/{id}</h4> 200/404  
<h4 id="ep-instructors-update">PUT /api/instructors/{id}</h4> 200/404 · 422/409/500  
<h4 id="ep-instructors-delete">DELETE /api/instructors/{id}</h4> 204/404

---

<h3 id="sec-students">3.3 Students — /api/students</h3>

<h4 id="ep-students-list">GET /api/students</h4>
Query: `page,size,sort,email,level`  
200:
```json
{ "items":[{"id":"uuid","firstName":"Sophie","lastName":"Bernard","email":"sophie@ex.com","registrationDate":"2025-02-15","level":"Intermediate","createdAt":"..."}], "page":1,"size":20,"total":5 }
```

<h4 id="ep-students-create">POST /api/students</h4>
Body:
```json
{ "firstName":"Sophie","lastName":"Bernard","email":"sophie@ex.com","registrationDate":"2025-02-15","level":"Intermediate" }
```
201: `Student` · 422/409/500

<h4 id="ep-students-get">GET /api/students/{id}</h4> 200/404  
<h4 id="ep-students-update">PUT /api/students/{id}</h4> 200/404 · 422/409/500  
<h4 id="ep-students-delete">DELETE /api/students/{id}</h4> 204/404

---

<h3 id="sec-enrollments">3.4 Enrollments — /api/enrollments</h3>

<h4 id="ep-enrollments-list">GET /api/enrollments</h4>
Query: `page,size,sort,status,courseId,studentId`  
200:
```json
{ "items":[{"id":"uuid","courseId":"uuid","studentId":"uuid","status":"Active","grade":85.5,"enrollmentDate":"...","createdAt":"..."}], "page":1,"size":20,"total":8 }
```

<h4 id="ep-enrollments-create">POST /api/enrollments</h4>
Body:
```json
{ "courseId":"uuid","studentId":"uuid","status":"Active","grade": 88.5 }
```
201: `Enrollment` · 422/409(duplicate courseId+studentId)/500

<h4 id="ep-enrollments-get">GET /api/enrollments/{id}</h4> 200/404  
<h4 id="ep-enrollments-update">PUT /api/enrollments/{id}</h4>
Body:
```json
{ "status":"Completed", "grade": 90 }
```
200/404 · 422/500  
<h4 id="ep-enrollments-delete">DELETE /api/enrollments/{id}</h4> 204/404

---

<h3 id="sec-health">3.5 Health — /api/health</h3>

<h4 id="ep-health">GET /api/health</h4>
200:
```json
{ "status":"ok","db":"up","time":"2025-01-01T10:00:00Z" }
```
500:
```json
{ "status":"degraded","db":"down" }
```

<h2 id="sec-schemas">4 – Schémas de données (types de réponse)</h2>

**Course**

```json
{ "id":"uuid","title":"string(5..100)","description":"string(10..500)","instructorId":"uuid","duration":40,"maxStudents":30,"price":299.99,"level":"Beginner|Intermediate|Advanced","createdAt":"ISO-UTC" }
```

**Instructor**

```json
{ "id":"uuid","firstName":"string(2..50)","lastName":"string(2..50)","specialty":"string(3..100)","email":"email unique","hireDate":"YYYY-MM-DD","createdAt":"ISO-UTC" }
```

**Student**

```json
{ "id":"uuid","firstName":"string(2..50)","lastName":"string(2..50)","email":"email unique","registrationDate":"YYYY-MM-DD","level":"Beginner|Intermediate|Advanced","createdAt":"ISO-UTC" }
```

**Enrollment**

```json
{ "id":"uuid","courseId":"uuid","studentId":"uuid","enrollmentDate":"ISO-UTC","status":"Active|Completed|Cancelled","grade":85.5,"createdAt":"ISO-UTC" }
```

<h2 id="sec-validation">5 – Règles de validation (résumé)</h2>
* **Course** : title 5..100, description 10..500, duration 1..200, maxStudents 5..100, price ≥0 ≤10000, level ∈ {Beginner,Intermediate,Advanced}, instructorId uuid.
* **Instructor** : first/last 2..50, specialty 3..100, email unique, hireDate ≤ now.
* **Student** : first/last 2..50, email unique, registrationDate ≤ now, level valide.
* **Enrollment** : (courseId,studentId) requis & **unique**, status ∈ {Active,Completed,Cancelled}, grade 0..100 (optionnelle).

<h2 id="sec-errors">6 – Erreurs & format commun</h2>
**Format recommandé**
```json
{ "status": 422, "error": "Unprocessable Entity", "message": "Validation failed", "details": { /* zod flatten */ }, "traceId": "req-9c1f..." }
```
Codes usuels : **422** validation · **409** conflit (email/enrollment) · **404** not found · **500** serveur.  
(**Phase 3** ajoutera **401/403** pour auth/rôles, mêmes payloads sinon.)

<h2 id="sec-openapi">7 – OpenAPI (extrait prêt à coller)</h2>
```yaml
paths:
  /api/courses:
    get: { summary: List courses, parameters: [{name: page,in: query, schema:{type:integer,min:1}}, {name: size,in: query, schema:{type:integer,min:1,max:100}}, {name: sort,in: query, schema:{type:string}}, {name: level,in: query, schema:{type:string,enum:[Beginner,Intermediate,Advanced]}}, {name: instructorId,in: query, schema:{type:string,format:uuid}}, {name: priceMin,in: query, schema:{type:number}}, {name: priceMax,in: query, schema:{type:number}}], responses: {"200": {description: OK}} }
    post: { summary: Create course, requestBody: { required: true }, responses: {"201": {description: Created}, "422": {description: Validation}, "409": {description: Conflict}} }
  /api/courses/{id}:
    get: { summary: Get course, parameters: [{name: id,in: path,required: true, schema:{type:string,format:uuid}}], responses: {"200": {description: OK}, "404": {description: Not Found}} }
    put: { summary: Update course, parameters: [{name: id,in: path,required: true, schema:{type:string,format:uuid}}], responses: {"200": {description: OK}, "404": {description: Not Found}, "422": {description: Validation}} }
    delete: { summary: Delete course, parameters: [{name: id,in: path,required: true, schema:{type:string,format:uuid}}], responses: {"204": {description: No Content}, "404": {description: Not Found}} }
```
*(à dupliquer pour instructors/students/enrollments/health)*

<h2 id="sec-compat">8 – Compatibilité Phase 3 (ajout auth/rôles sans casser)</h2>
* **Mêmes URLs et schémas** qu’en Phase 1.  
* Tu brancheras **JWT/Clerk/NextAuth** et des **guards** → seules nouveautés : **401 Unauthorized** (non connecté) et **403 Forbidden** (rôle insuffisant).  
* Aucune modif des tableaux ci-dessus (juste colonne “Erreurs” qui inclura 401/403 dans ta doc Phase 3).

---

tu peux copier/coller direct. si tu veux, je te génère aussi le **fichier `api-tests.http`** aligné à **chaque ancre** de la table (un bloc par endpoint).
