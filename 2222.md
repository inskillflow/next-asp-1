ok, on respire üòÖ ‚Äî voil√† **Phase 1** en **m√™me style**, **ultra-exhaustive**, avec **UNE GROSSE TABLE r√©cap des endpoints tout en haut** (avant les sections), **ancres HTML stables**, et **100% compatible avec ta Phase 3** (m√™mes URLs/payloads; tu ajouteras 401/403 plus tard).

---

# Phase 1 ‚Äî D√©veloppement des APIs (Next.js + Prisma/PostgreSQL)

<ul>
  <li><a href="#sec-phase1">Phase 1 ‚Äî D√©veloppement des APIs</a></li>
  <li><a href="#sec-master">1 ‚Äì Tableau r√©capitulatif EXHAUSTIF des endpoints</a></li>
  <li><a href="#sec-conventions">2 ‚Äì Conventions HTTP (communes)</a></li>
  <li>
    <a href="#sec-endpoints">3 ‚Äì Endpoints (d√©tails, I/O & liens)</a>
    <ul>
      <li><a href="#sec-courses">3.1 Courses ‚Äî /api/courses</a> (<a href="#ep-courses-list">liste</a>, <a href="#ep-courses-create">create</a>, <a href="#ep-courses-get">get</a>, <a href="#ep-courses-update">update</a>, <a href="#ep-courses-delete">delete</a>)</li>
      <li><a href="#sec-instructors">3.2 Instructors ‚Äî /api/instructors</a> (<a href="#ep-instructors-list">liste</a>, <a href="#ep-instructors-create">create</a>, <a href="#ep-instructors-get">get</a>, <a href="#ep-instructors-update">update</a>, <a href="#ep-instructors-delete">delete</a>)</li>
      <li><a href="#sec-students">3.3 Students ‚Äî /api/students</a> (<a href="#ep-students-list">liste</a>, <a href="#ep-students-create">create</a>, <a href="#ep-students-get">get</a>, <a href="#ep-students-update">update</a>, <a href="#ep-students-delete">delete</a>)</li>
      <li><a href="#sec-enrollments">3.4 Enrollments ‚Äî /api/enrollments</a> (<a href="#ep-enrollments-list">liste</a>, <a href="#ep-enrollments-create">create</a>, <a href="#ep-enrollments-get">get</a>, <a href="#ep-enrollments-update">update</a>, <a href="#ep-enrollments-delete">delete</a>)</li>
      <li><a href="#sec-health">3.5 Health ‚Äî /api/health</a></li>
    </ul>
  </li>
  <li><a href="#sec-schemas">4 ‚Äì Sch√©mas de donn√©es (types de r√©ponse)</a></li>
  <li><a href="#sec-validation">5 ‚Äì R√®gles de validation (r√©sum√©)</a></li>
  <li><a href="#sec-errors">6 ‚Äì Erreurs & format commun</a></li>
  <li><a href="#sec-openapi">7 ‚Äì OpenAPI (extrait pr√™t √† coller)</a></li>
  <li><a href="#sec-compat">8 ‚Äì Compatibilit√© Phase 3 (ajout auth/r√¥les sans casser)</a></li>
</ul>

<h1 id="sec-phase1">Phase 1 ‚Äî D√©veloppement des APIs</h1>

<h2 id="sec-master">1 ‚Äì Tableau r√©capitulatif EXHAUSTIF des endpoints</h2>

> **Phase 1 :** tous publics (pas d‚Äôauth). **Phase 3 :** m√™mes endpoints, on ajoute 401/403 via guards.

| #  | Ressource   | M√©thode | URL                     | Query (liste)                                         | Body (req)                                                          | R√©ponse succ√®s              | Codes succ√®s | Erreurs typiques | Ancre                                                       |
| -- | ----------- | ------- | ----------------------- | ----------------------------------------------------- | ------------------------------------------------------------------- | --------------------------- | ------------ | ---------------- | ----------------------------------------------------------- |
| 1  | Courses     | GET     | `/api/courses`          | `page,size,sort,level,instructorId,priceMin,priceMax` | ‚Äî                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-courses-list">#ep-courses-list</a>             |
| 2  | Courses     | POST    | `/api/courses`          | ‚Äî                                                     | `{title,description,instructorId,duration,maxStudents,price,level}` | `Course`                    | 201          | 422,409,500      | <a href="#ep-courses-create">#ep-courses-create</a>         |
| 3  | Courses     | GET     | `/api/courses/{id}`     | ‚Äî                                                     | ‚Äî                                                                   | `Course`                    | 200/404      | 404,500          | <a href="#ep-courses-get">#ep-courses-get</a>               |
| 4  | Courses     | PUT     | `/api/courses/{id}`     | ‚Äî                                                     | (m√™mes champs, partiels ok)                                         | `Course`                    | 200/404      | 422,404,409,500  | <a href="#ep-courses-update">#ep-courses-update</a>         |
| 5  | Courses     | DELETE  | `/api/courses/{id}`     | ‚Äî                                                     | ‚Äî                                                                   | ‚Äî                           | 204/404      | 404,500          | <a href="#ep-courses-delete">#ep-courses-delete</a>         |
| 6  | Instructors | GET     | `/api/instructors`      | `page,size,sort,email,specialty`                      | ‚Äî                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-instructors-list">#ep-instructors-list</a>     |
| 7  | Instructors | POST    | `/api/instructors`      | ‚Äî                                                     | `{firstName,lastName,specialty,email,hireDate}`                     | `Instructor`                | 201          | 422,409,500      | <a href="#ep-instructors-create">#ep-instructors-create</a> |
| 8  | Instructors | GET     | `/api/instructors/{id}` | ‚Äî                                                     | ‚Äî                                                                   | `Instructor`                | 200/404      | 404,500          | <a href="#ep-instructors-get">#ep-instructors-get</a>       |
| 9  | Instructors | PUT     | `/api/instructors/{id}` | ‚Äî                                                     | (champs du POST)                                                    | `Instructor`                | 200/404      | 422,404,409,500  | <a href="#ep-instructors-update">#ep-instructors-update</a> |
| 10 | Instructors | DELETE  | `/api/instructors/{id}` | ‚Äî                                                     | ‚Äî                                                                   | ‚Äî                           | 204/404      | 404,500          | <a href="#ep-instructors-delete">#ep-instructors-delete</a> |
| 11 | Students    | GET     | `/api/students`         | `page,size,sort,email,level`                          | ‚Äî                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-students-list">#ep-students-list</a>           |
| 12 | Students    | POST    | `/api/students`         | ‚Äî                                                     | `{firstName,lastName,email,registrationDate,level}`                 | `Student`                   | 201          | 422,409,500      | <a href="#ep-students-create">#ep-students-create</a>       |
| 13 | Students    | GET     | `/api/students/{id}`    | ‚Äî                                                     | ‚Äî                                                                   | `Student`                   | 200/404      | 404,500          | <a href="#ep-students-get">#ep-students-get</a>             |
| 14 | Students    | PUT     | `/api/students/{id}`    | ‚Äî                                                     | (champs du POST)                                                    | `Student`                   | 200/404      | 422,404,409,500  | <a href="#ep-students-update">#ep-students-update</a>       |
| 15 | Students    | DELETE  | `/api/students/{id}`    | ‚Äî                                                     | ‚Äî                                                                   | ‚Äî                           | 204/404      | 404,500          | <a href="#ep-students-delete">#ep-students-delete</a>       |
| 16 | Enrollments | GET     | `/api/enrollments`      | `page,size,sort,status,courseId,studentId`            | ‚Äî                                                                   | `{items[],page,size,total}` | 200          | 500              | <a href="#ep-enrollments-list">#ep-enrollments-list</a>     |
| 17 | Enrollments | POST    | `/api/enrollments`      | ‚Äî                                                     | `{courseId,studentId,status,grade?}`                                | `Enrollment`                | 201          | 422,409,500      | <a href="#ep-enrollments-create">#ep-enrollments-create</a> |
| 18 | Enrollments | GET     | `/api/enrollments/{id}` | ‚Äî                                                     | ‚Äî                                                                   | `Enrollment`                | 200/404      | 404,500          | <a href="#ep-enrollments-get">#ep-enrollments-get</a>       |
| 19 | Enrollments | PUT     | `/api/enrollments/{id}` | ‚Äî                                                     | `{status?,grade?}`                                                  | `Enrollment`                | 200/404      | 422,404,500      | <a href="#ep-enrollments-update">#ep-enrollments-update</a> |
| 20 | Enrollments | DELETE  | `/api/enrollments/{id}` | ‚Äî                                                     | ‚Äî                                                                   | ‚Äî                           | 204/404      | 404,500          | <a href="#ep-enrollments-delete">#ep-enrollments-delete</a> |
| 21 | Health      | GET     | `/api/health`           | ‚Äî                                                     | ‚Äî                                                                   | `{status,db,time}`          | 200/500      | 500              | <a href="#ep-health">#ep-health</a>                         |







<h2 id="sec-conventions">2 ‚Äì Conventions HTTP (communes)</h2>

JSON, pagination `page/size`, tri `sort=field:asc|desc`, dates ISO-UTC, 2xx constants; **401/403 seront ajout√©s en Phase 3 sans changer cette table**.


* **Format** : `application/json; charset=utf-8` (requ√™tes & r√©ponses).
* **Dates** : ISO-8601 en **UTC** (ex. `2025-01-01T10:00:00Z`).
* **Pagination** : `page` (‚â•1), `size` (1..100).
* **Tri** : `sort=<champ>:asc|desc` (ex. `sort=createdAt:desc`).
* **Filtres** : param√®tres d√©di√©s par ressource (voir chaque endpoint).
* **Codes succ√®s** : `200 OK`, `201 Created`, `204 No Content`.
* **Erreurs Phase 1** : `400/409/422/404/500`.
* **Compat Phase 3** : on ajoutera `401 Unauthorized` / `403 Forbidden` **sans changer** les URLs ni les payloads.

---

<h2 id="sec-endpoints">3 ‚Äì Endpoints (d√©tails, I/O & liens)</h2>

> Tous **publics** en Phase 1. En Phase 3, on activera des guards sans modifier ces sections.

---

<h3 id="sec-courses">3.1 Courses ‚Äî <code>/api/courses</code></h3>

<h4 id="ep-courses-list">GET /api/courses</h4>

**Query** : `page`, `size`, `sort`, `level`, `instructorId`, `priceMin`, `priceMax`
**200 OK**

```json
{
  "items": [
    {
      "id": "uuid",
      "title": "Intro C#",
      "level": "Beginner",
      "price": 299.99,
      "instructorId": "uuid",
      "createdAt": "2025-01-01T10:00:00Z"
    }
  ],
  "page": 1,
  "size": 20,
  "total": 42
}
```

**Erreurs** : `500`

---

<h4 id="ep-courses-create">POST /api/courses</h4>

**Body**

```json
{
  "title": "Intro C#",
  "description": "...",
  "instructorId": "uuid",
  "duration": 40,
  "maxStudents": 30,
  "price": 299.99,
  "level": "Beginner"
}
```

**201 Created** ‚Üí objet `Course`
**Erreurs** : `422` (validation), `409` (conflit), `500`

---

<h4 id="ep-courses-get">GET /api/courses/{id}</h4>

**200 OK** ‚Üí `Course` ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h4 id="ep-courses-update">PUT /api/courses/{id}</h4>

**Body** : m√™mes champs que POST (autorisez partiels si vous g√©rez ‚ÄúPATCH-like‚Äù).
**200 OK** ‚Üí `Course` ‚Ä¢ **404 Not Found**
**Erreurs** : `422`, `404`, `409`, `500`

---

<h4 id="ep-courses-delete">DELETE /api/courses/{id}</h4>

**204 No Content** ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h3 id="sec-instructors">3.2 Instructors ‚Äî <code>/api/instructors</code></h3>

<h4 id="ep-instructors-list">GET /api/instructors</h4>

**Query** : `page`, `size`, `sort`, `email`, `specialty`
**200 OK**

```json
{
  "items": [
    {
      "id": "uuid",
      "firstName": "Ada",
      "lastName": "Lovelace",
      "email": "ada@ex.com",
      "specialty": "Informatique",
      "hireDate": "2019-08-20",
      "createdAt": "2025-01-01T10:00:00Z"
    }
  ],
  "page": 1,
  "size": 20,
  "total": 3
}
```

**Erreurs** : `500`

---

<h4 id="ep-instructors-create">POST /api/instructors</h4>

**Body**

```json
{
  "firstName": "Ada",
  "lastName": "Lovelace",
  "specialty": "Informatique",
  "email": "ada@ex.com",
  "hireDate": "2019-08-20"
}
```

**201 Created** ‚Üí `Instructor`
**Erreurs** : `422`, `409`, `500`

---

<h4 id="ep-instructors-get">GET /api/instructors/{id}</h4>

**200 OK** ‚Üí `Instructor` ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h4 id="ep-instructors-update">PUT /api/instructors/{id}</h4>

**Body** : champs du POST
**200 OK** ‚Ä¢ **404 Not Found**
**Erreurs** : `422`, `404`, `409`, `500`

---

<h4 id="ep-instructors-delete">DELETE /api/instructors/{id}</h4>

**204 No Content** ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h3 id="sec-students">3.3 Students ‚Äî <code>/api/students</code></h3>

<h4 id="ep-students-list">GET /api/students</h4>

**Query** : `page`, `size`, `sort`, `email`, `level`
**200 OK**

```json
{
  "items": [
    {
      "id": "uuid",
      "firstName": "Sophie",
      "lastName": "Bernard",
      "email": "sophie@ex.com",
      "registrationDate": "2025-02-15",
      "level": "Intermediate",
      "createdAt": "2025-01-01T10:00:00Z"
    }
  ],
  "page": 1,
  "size": 20,
  "total": 5
}
```

**Erreurs** : `500`

---

<h4 id="ep-students-create">POST /api/students</h4>

**Body**

```json
{
  "firstName": "Sophie",
  "lastName": "Bernard",
  "email": "sophie@ex.com",
  "registrationDate": "2025-02-15",
  "level": "Intermediate"
}
```

**201 Created** ‚Üí `Student`
**Erreurs** : `422`, `409`, `500`

---

<h4 id="ep-students-get">GET /api/students/{id}</h4>

**200 OK** ‚Üí `Student` ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h4 id="ep-students-update">PUT /api/students/{id}</h4>

**Body** : champs du POST
**200 OK** ‚Ä¢ **404 Not Found**
**Erreurs** : `422`, `404`, `409`, `500`

---

<h4 id="ep-students-delete">DELETE /api/students/{id}</h4>

**204 No Content** ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h3 id="sec-enrollments">3.4 Enrollments ‚Äî <code>/api/enrollments</code></h3>

<h4 id="ep-enrollments-list">GET /api/enrollments</h4>

**Query** : `page`, `size`, `sort`, `status`, `courseId`, `studentId`
**200 OK**

```json
{
  "items": [
    {
      "id": "uuid",
      "courseId": "uuid",
      "studentId": "uuid",
      "status": "Active",
      "grade": 85.5,
      "enrollmentDate": "2025-01-12T09:30:00Z",
      "createdAt": "2025-01-12T09:30:00Z"
    }
  ],
  "page": 1,
  "size": 20,
  "total": 8
}
```

**Erreurs** : `500`

---

<h4 id="ep-enrollments-create">POST /api/enrollments</h4>

**Body**

```json
{
  "courseId": "uuid",
  "studentId": "uuid",
  "status": "Active",
  "grade": 88.5
}
```

**201 Created** ‚Üí `Enrollment`
**Erreurs** : `422`, `409` (doublon `courseId`+`studentId`), `500`

---

<h4 id="ep-enrollments-get">GET /api/enrollments/{id}</h4>

**200 OK** ‚Üí `Enrollment` ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h4 id="ep-enrollments-update">PUT /api/enrollments/{id}</h4>

**Body**

```json
{ "status": "Completed", "grade": 90 }
```

**200 OK** ‚Üí `Enrollment` ‚Ä¢ **404 Not Found**
**Erreurs** : `422`, `404`, `500`

---

<h4 id="ep-enrollments-delete">DELETE /api/enrollments/{id}</h4>

**204 No Content** ‚Ä¢ **404 Not Found**
**Erreurs** : `404`, `500`

---

<h3 id="sec-health">3.5 Health ‚Äî <code>/api/health</code></h3>

<h4 id="ep-health">GET /api/health</h4>

**200 OK**

```json
{ "status": "ok", "db": "up", "time": "2025-01-01T10:00:00Z" }
```

**500**

```json
{ "status": "degraded", "db": "down" }
```













<h2 id="sec-schemas">4 ‚Äì Sch√©mas de donn√©es (types de r√©ponse)</h2>

**Course**

```json
{ "id":"uuid","title":"string(5..100)","description":"string(10..500)","instructorId":"uuid","duration":40,"maxStudents":30,"price":299.99,"level":"Beginner|Intermediate|Advanced","createdAt":"ISO-UTC" }
```

**Instructor**

```json
{ "id":"uuid","firstName":"string(2..50)","lastName":"string(2..50)","specialty":"string(3..100)","email":"email unique","hireDate":"YYYY-MM-DD","createdAt":"ISO-UTC" }
```

**Student**

```json
{ "id":"uuid","firstName":"string(2..50)","lastName":"string(2..50)","email":"email unique","registrationDate":"YYYY-MM-DD","level":"Beginner|Intermediate|Advanced","createdAt":"ISO-UTC" }
```

**Enrollment**

```json
{ "id":"uuid","courseId":"uuid","studentId":"uuid","enrollmentDate":"ISO-UTC","status":"Active|Completed|Cancelled","grade":85.5,"createdAt":"ISO-UTC" }
```

<h2 id="sec-validation">5 ‚Äì R√®gles de validation (r√©sum√©)</h2>
* **Course** : title 5..100, description 10..500, duration 1..200, maxStudents 5..100, price ‚â•0 ‚â§10000, level ‚àà {Beginner,Intermediate,Advanced}, instructorId uuid.
* **Instructor** : first/last 2..50, specialty 3..100, email unique, hireDate ‚â§ now.
* **Student** : first/last 2..50, email unique, registrationDate ‚â§ now, level valide.
* **Enrollment** : (courseId,studentId) requis & **unique**, status ‚àà {Active,Completed,Cancelled}, grade 0..100 (optionnelle).

<h2 id="sec-errors">6 ‚Äì Erreurs & format commun</h2>
**Format recommand√©**
```json
{ "status": 422, "error": "Unprocessable Entity", "message": "Validation failed", "details": { /* zod flatten */ }, "traceId": "req-9c1f..." }
```
Codes usuels : **422** validation ¬∑ **409** conflit (email/enrollment) ¬∑ **404** not found ¬∑ **500** serveur.  
(**Phase 3** ajoutera **401/403** pour auth/r√¥les, m√™mes payloads sinon.)

<h2 id="sec-openapi">7 ‚Äì OpenAPI (extrait pr√™t √† coller)</h2>
```yaml
paths:
  /api/courses:
    get: { summary: List courses, parameters: [{name: page,in: query, schema:{type:integer,min:1}}, {name: size,in: query, schema:{type:integer,min:1,max:100}}, {name: sort,in: query, schema:{type:string}}, {name: level,in: query, schema:{type:string,enum:[Beginner,Intermediate,Advanced]}}, {name: instructorId,in: query, schema:{type:string,format:uuid}}, {name: priceMin,in: query, schema:{type:number}}, {name: priceMax,in: query, schema:{type:number}}], responses: {"200": {description: OK}} }
    post: { summary: Create course, requestBody: { required: true }, responses: {"201": {description: Created}, "422": {description: Validation}, "409": {description: Conflict}} }
  /api/courses/{id}:
    get: { summary: Get course, parameters: [{name: id,in: path,required: true, schema:{type:string,format:uuid}}], responses: {"200": {description: OK}, "404": {description: Not Found}} }
    put: { summary: Update course, parameters: [{name: id,in: path,required: true, schema:{type:string,format:uuid}}], responses: {"200": {description: OK}, "404": {description: Not Found}, "422": {description: Validation}} }
    delete: { summary: Delete course, parameters: [{name: id,in: path,required: true, schema:{type:string,format:uuid}}], responses: {"204": {description: No Content}, "404": {description: Not Found}} }
```
*(√† dupliquer pour instructors/students/enrollments/health)*

<h2 id="sec-compat">8 ‚Äì Compatibilit√© Phase 3 (ajout auth/r√¥les sans casser)</h2>
* **M√™mes URLs et sch√©mas** qu‚Äôen Phase 1.  
* Tu brancheras **JWT/Clerk/NextAuth** et des **guards** ‚Üí seules nouveaut√©s : **401 Unauthorized** (non connect√©) et **403 Forbidden** (r√¥le insuffisant).  
* Aucune modif des tableaux ci-dessus (juste colonne ‚ÄúErreurs‚Äù qui inclura 401/403 dans ta doc Phase 3).

---

tu peux copier/coller direct. si tu veux, je te g√©n√®re aussi le **fichier `api-tests.http`** align√© √† **chaque ancre** de la table (un bloc par endpoint).
